<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="utf-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
  <meta name="description" content=""/>
  <meta name="author" content=""/>
  <title>Tables</title>
  <link href="css/styles.css" rel="stylesheet"/>
  <link href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css" rel="stylesheet" crossorigin="anonymous"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/all.min.js" crossorigin="anonymous"></script>

  <script src="http://code.jquery.com/jquery-1.11.2.min.js"></script>

  <script>
      let searchData = null;

    // 프로그램 시작과 동시에 메소드 실행
    (function () {
      let result;
      // ajax를 이용하여 빗썸 API를 조회한다.
      $.ajax({
        type: "get",
        url: "https://api.bithumb.com/public/orderbook/BTC_KRW",
        success: function (data) {
          // 성공시 데이터 정형화를 위해 Controller로 넘기는 sendController 호출
          console.log("성공");
          console.log(data.data);
          result = data.data;
            searchData = data.data;
          sendController(result);
        },
        error: function (data) {
          console.log("실패");
          console.log(data);
        }
      });
    }());

    // json형태의 데이터를 파라미터로 받는다.
    function sendController(result) {
        let my_tbody = document.getElementById('wpqkfemfdjrk');
      console.log("sendController");
      // 데이터를 넘기기위해 String형태로 변환
      let lookupData = JSON.stringify(result);

      // ajax를 이용하여 전달
      $.ajax({
        type: "post",
        url: "receiveData",
        data: {"result": lookupData},
        success: function (data) {
          console.log("보냄");
          console.log(typeof data);
          console.log(typeof data[0]);
          console.log(data[0][0]);

          for (let i = 0 ; i < 30 ; ++i) {
              let row = my_tbody.insertRow(my_tbody.rows.length);
              let cell1 = row.insertCell(0);
              let cell2 = row.insertCell(1);
              let cell3 = row.insertCell(2);
              let cell4 = row.insertCell(3);

              for (let j = 0; j < 30; ++j) {
                  cell1.innerHTML = data[0][i];
                  cell2.innerHTML = data[1][i];
                  cell3.innerHTML = data[2][i];
                  cell4.innerHTML = data[3][i];
              }
          }
        },
        error: function (data) {
          console.log("못 보냄");
        }
      });
    }

    $(document).ready(function () {
        $('#dtBasicExample').DataTable({
            "paging": false // false to disable pagination (or any other option)
        });
        $('.dataTables_length').addClass('bs-select');
    });

    function dataSort(target) {
        let sendSearchData = JSON.stringify(searchData);
        console.log(searchData);
        console.log(typeof searchData);
        $.ajax({
            type: "post",
            url: "searchData",
            data: {"sendSearchData": sendSearchData, "target" : target},
            success: function (data) {
                console.log("정렬 보냄");
                console.log(typeof data);
                console.log(typeof data[0]);
                console.log(data[0][0]);
                searchData = data;
                for (let i = 0 ; i < 30 ; ++i) {
                    let row = my_tbody.insertRow(my_tbody.rows.length);
                    let cell1 = row.insertCell(0);
                    let cell2 = row.insertCell(1);
                    let cell3 = row.insertCell(2);
                    let cell4 = row.insertCell(3);

                    for (let j = 0; j < 30; ++j) {
                        cell1.innerHTML = data[0][i];
                        cell2.innerHTML = data[1][i];
                        cell3.innerHTML = data[2][i];
                        cell4.innerHTML = data[3][i];
                    }
                }
            },
            error: function (data) {
                console.log("못 보냄");
            }
        });
    }


  </script>
</head>
<body class="sb-nav-fixed">
<div id="layoutSidenav">
  <main>
    <div class="container-fluid ml-10">
      <h1 class="mt-4">Tables</h1>
      <div class="card mb-4">
        <div class="card-body">
          Bithumb order_book data
        </div>
      </div>
      <div class="card mb-4">
        <div class="card-header">
          <i class="fas fa-table mr-1"></i>
          Bithumb order_book data
          <button id="asksPrice" onclick="dataSort('asksPrice')">매수금액 정렬</button>
          <button id="asksQuantity" onclick="dataSort('asksQuantity')">매수량 정렬</button>
          <button id="bidsPrice" onclick="dataSort('bidsPrice')">매도금액 정렬</button>
          <button id="bidsQuantity" onclick="dataSort('bidsQuantity')">매도량 정렬</button>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
              <thead>
              <tr>
                <th>매수 금액</th>
                <th>매수 량</th>
                <th>매도 금액</th>
                <th>매도 량</th>
              </tr>
              </thead>
              <tbody id="wpqkfemfdjrk">
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </main>
</div>
<script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
<script src="js/scripts.js"></script>
<script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js" crossorigin="anonymous"></script>
<script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js" crossorigin="anonymous"></script>
<script src="assets/demo/datatables-demo.js"></script>
</body>
</html>
